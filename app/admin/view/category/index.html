<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <title>分类管理</title>
    <link rel="stylesheet" href="/static/layui/css/layui.css">
</head>
<body style="padding: 20px; background-color: #fff;">
    <div class="layui-card">
        <div class="layui-card-header">
            分类管理
            <button class="layui-btn layui-btn-sm layui-btn-normal" style="float: right; margin-top: 10px;" onclick="add()">添加分类</button>
        </div>
        <div class="layui-card-body">
            <table id="categoryTable" lay-filter="categoryTable"></table>
        </div>
    </div>

    <script type="text/html" id="bar">
        <a class="layui-btn layui-btn-xs" lay-event="edit">编辑</a>
        <a class="layui-btn layui-btn-danger layui-btn-xs" lay-event="del">删除</a>
    </script>

    <script src="/static/layui/layui.js"></script>
    <script>
        var table, layer;
        layui.use(['table', 'layer'], function(){
            table = layui.table;
            layer = layui.layer;
            var $ = layui.$;

            table.render({
                elem: '#categoryTable',
                url: "{:url('category/index')}",
                cols: [[
                    {field: 'id', title: 'ID', width: 80, sort: true},
                    {field: 'name', title: '分类名称', templet: function(d){
                        var prefix = d.pid > 0 ? ' &nbsp;&nbsp; ┝ ' : '';
                        return prefix + d.name;
                    }},
                    {field: 'alias', title: '别名'},
                    {field: 'sort', title: '排序', width: 80},
                    {field: 'create_time', title: '创建时间', width: 180},
                    {fixed: 'right', title: '操作', toolbar: '#bar', width: 150}
                ]]
            });

            // 行工具栏事件
            table.on('tool(categoryTable)', function(obj){
                var data = obj.data;
                if(obj.event === 'del'){
                    layer.confirm('确认删除该分类吗？', function(index){
                        $.post("{:url('category/delete')}", {id: data.id}, function(res){
                            if(res.code === 1){
                                obj.del();
                                layer.close(index);
                                layer.msg(res.msg, {icon: 1});
                            }else{
                                layer.msg(res.msg, {icon: 2});
                            }
                        }, 'json');
                    });
                } else if(obj.event === 'edit'){
                    edit(data.id);
                }
            });
        });

        function add() {
            openForm('添加分类', "{:url('category/form')}");
        }

        function edit(id) {
            openForm('编辑分类', "{:url('category/form')}?id=" + id);
        }

        function openForm(title, url) {
            layer.open({
                type: 2,
                title: title,
                content: url,
                area: ['500px', '400px'],
                end: function(){
                    table.reload('categoryTable');
                }
            });
        }
    </script>
</body>
</html>
