<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <title>余额记录</title>
    <link rel="stylesheet" href="/static/layui/css/layui.css">
</head>
<body style="padding: 20px; background-color: #fff;">
    <div class="layui-card">
        <div class="layui-card-header">余额充值记录</div>
        <div class="layui-card-body">
            <div class="layui-form layui-form-pane" style="margin-bottom: 10px;">
                <div class="layui-form-item">
                    <div class="layui-inline">
                        <label class="layui-form-label">订单号</label>
                        <div class="layui-input-inline">
                            <input type="text" id="search-no" placeholder="订单号搜索" class="layui-input">
                        </div>
                    </div>
                    <div class="layui-inline">
                        <button class="layui-btn layui-btn-primary" onclick="search()"><i class="layui-icon layui-icon-search"></i> 搜索</button>
                    </div>
                </div>
            </div>
            <table id="balanceTable" lay-filter="balanceTable"></table>
        </div>
    </div>

    <script type="text/html" id="statusTpl">
        {{# if(d.status == 1){ }}
        <span class="layui-badge layui-bg-green">充值成功</span>
        {{# } else if(d.status == 0 && d.is_expired){ }}
        <span class="layui-badge" style="background-color: red !important; color: white !important;">已超时</span>
        {{# } else { }}
        <span class="layui-badge layui-bg-orange">等待支付</span>
        {{# } }}
    </script>

    <script type="text/html" id="payTypeTpl">
        {{# if(d.pay_type == 'alipay'){ }}
            <span style="color: #1677ff;">支付宝</span>
        {{# } else if(d.pay_type == 'wxpay' || d.pay_type == 'wechat'){ }}
            <span style="color: #09b908;">微信支付</span>
        {{# } else if(d.pay_type == 'qqpay'){ }}
            <span style="color: #12b7f5;">QQ钱包</span>
        {{# } else if(d.pay_type == 'balance'){ }}
            <span style="color: #ff8c00;">余额支付</span>
        {{# } else if(d.pay_type == 'manual'){ }}
            <span class="layui-badge layui-bg-gray">后台手动</span>
        {{# } else if(d.pay_type){ }}
            <span>{{d.pay_type}}</span>
        {{# } else { }}
            <span>-</span>
        {{# } }}
    </script>

    <script src="/static/layui/layui.js"></script>
    <script>
        var table, layer;
        layui.use(['table', 'layer'], function(){
            table = layui.table;
            layer = layui.layer;
            var $ = layui.$;

            table.render({
                elem: '#balanceTable',
                url: "{:url('order/balance')}",
                page: true,
                cols: [[
                    {field: 'order_no', title: '订单号', width: 220},
                    {field: 'user', title: '用户', templet: function(d){ return d.user ? d.user.username : '游客'; }},
                    {field: 'price', title: '充值金额', width: 120, style: 'color: #ff5722; font-weight: bold;'},
                    {field: 'status', title: '状态', templet: '#statusTpl', width: 120},
                    {field: 'pay_type', title: '支付方式', width: 120, templet: '#payTypeTpl'},
                    {field: 'create_time', title: '创建时间', width: 180},
                    {field: 'pay_time', title: '完成时间', width: 180, templet: function(d){ return d.pay_time > 0 ? layui.util.toDateString(d.pay_time * 1000) : '-'; }}
                ]]
            });
        });

        function search() {
            var order_no = layui.$('#search-no').val();
            table.reload('balanceTable', {
                where: {order_no: order_no},
                page: {curr: 1}
            });
        }
    </script>
</body>
</html>
