<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <title>VIP等级设置</title>
    <link rel="stylesheet" href="/static/layui/css/layui.css">
</head>
<body style="padding: 20px; background-color: #fff;">
    <div class="layui-card">
        <div class="layui-card-header">
            VIP等级管理
            <button class="layui-btn layui-btn-sm" style="float: right; margin-top: 5px;" onclick="editVip(0)">添加VIP等级</button>
        </div>
        <div class="layui-card-body">
            <table id="vipTable" lay-filter="vipTable"></table>
        </div>
    </div>

    <script type="text/html" id="bar">
        <a class="layui-btn layui-btn-xs" lay-event="edit">编辑</a>
        <a class="layui-btn layui-btn-danger layui-btn-xs" lay-event="del">删除</a>
    </script>

    <script src="/static/layui/layui.js"></script>
    <script>
        var table, layer;
        layui.use(['table', 'layer'], function(){
            table = layui.table;
            layer = layui.layer;
            var $ = layui.$;

            table.render({
                elem: '#vipTable',
                url: "{:url('vip/index')}",
                cols: [[
                    {field: 'id', title: 'ID', width: 60},
                    {field: 'level', title: '权重', width: 80},
                    {field: 'name', title: '等级名称', width: 150},
                    {field: 'price', title: '销售价格 (金币)', width: 120},
                    {field: 'duration', title: '有效期(天)', width: 120, templet: function(d){ return d.duration == 0 ? '永久' : d.duration; }},
                    {field: 'description', title: '特权简述'},
                    {fixed: 'right', title: '操作', toolbar: '#bar', width: 130}
                ]]
            });

            table.on('tool(vipTable)', function(obj){
                var data = obj.data;
                if(obj.event === 'edit'){
                    editVip(data.id);
                } else if(obj.event === 'del'){
                    layer.confirm('确定删除该VIP等级吗？', function(index){
                        $.post("{:url('vip/delete')}", {id: data.id}, function(res){
                            if(res.code == 1){
                                table.reload('vipTable');
                                layer.close(index);
                                layer.msg(res.msg, {icon: 1});
                            } else {
                                layer.msg(res.msg, {icon: 2});
                            }
                        }, 'json');
                    });
                }
            });
        });

        function editVip(id) {
            layer.open({
                type: 2,
                title: id > 0 ? '编辑 VIP 等级' : '添加 VIP 等级',
                area: ['600px', '500px'],
                content: "{:url('vip/form')}?id=" + id,
                end: function() { table.reload('vipTable'); }
            });
        }
    </script>
</body>
</html>
